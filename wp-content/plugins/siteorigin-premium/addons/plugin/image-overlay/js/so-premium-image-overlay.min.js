window.SiteOriginPremium=window.SiteOriginPremium||{},SiteOriginPremium.ImageOverlay=function(i,t,e){var o=jQuery;this.image=i,this.options=t,this.init=function(){this.imageContainer||(this.imageContainer=o(i).parent().closest("div"),this.createChildren(),this.addEventListeners()),"function"==typeof OnScreen&&(this.onScreen=new OnScreen({debounce:0})),setTimeout(this.layoutChildren.bind(this),150)},this.createChildren=function(){if(this.overlayContainer=o('<div class="so-premium-image-overlay-container"></div>'),this.overlay=o('<div class="so-premium-image-overlay"></div>'),this.overlayBackground=o('<div class="so-premium-image-overlay-background"></div>'),this.overlayBackground.css({backgroundColor:t.overlay_color,opacity:t.overlay_opacity}),this.overlay.append(this.overlayBackground),void 0===this.options.overlay_text)var i=this.image.title;else if("object"==typeof this.options.overlay_text)i=void 0===this.options.overlay_text[e]?this.image.title:this.options.overlay_text[e];else i=this.options.overlay_text;this.overlayText=o('<div class="so-premium-image-overlay-text">'+i+"</div>"),o(this.image).css("pointerEvents","none");var a={margin:"0",padding:this.options.text_padding};t.hasOwnProperty("font")&&t.font&&(a.fontFamily=t.font.family,t.font.hasOwnProperty("weight")&&(a.fontWeight=t.font.weight),t.font.hasOwnProperty("url")&&o("head").append('<link rel="stylesheet" media="all" href="'+t.font.url+'"/>')),t.hasOwnProperty("text_size")&&(a.fontSize=t.text_size),t.hasOwnProperty("text_color")&&(a.color=t.text_color),a.textAlign=t.text_align,this.overlayText.css(a),this.overlay.append(this.overlayText),this.overlay.css("opacity",0),this.overlayContainer.append(this.overlay),t.widget_id&&this.overlayContainer.addClass("so-premium-"+t.widget_id),this.overlayContainer.css({overflow:"hidden"}),this.imageContainer.find("> a").length?this.imageContainer.find("> a").append(this.overlayContainer):this.imageContainer.append(this.overlayContainer)},this.layoutChildren=function(){var i=o(this.image),e=this.imageContainer.position();e.width=Math.min(this.imageContainer.width(),i.width()),e.height=Math.min(this.imageContainer.height(),i.height());var a={top:Math.max(0,i.position().top)+"px",left:Math.max(0,i.position().left)+"px",width:e.width+"px",height:e.height+"px",maxWidth:this.imageContainer.css("maxWidth"),maxHeight:this.imageContainer.css("maxHeight")};this.overlayContainer.css(a),this.isDesktop=window.matchMedia("(min-width: "+this.options.responsive_breakpoint+")").matches;var n={top:0,left:0,width:e.width,height:e.height,maxWidth:i.css("maxWidth"),maxHeight:i.css("maxHeight")},s=this.options.overlay_size;switch(this.options.overlay_position){case"top":n.height=e.height*s;break;case"right":n.width=e.width*s,n.left=e.width-n.width;break;case"bottom":n.height=e.height*s,n.top=e.height-n.height;break;case"left":n.width=e.width*s}n.top+="px",n.width+="px",n.height+="px",n.left+="px",this.overlay.css(n);var r=this.overlay.outerHeight(),h=this.overlayText.outerHeight(),l={};switch(this.options.text_position){case"top":l.top=0;break;case"middle":l.top=.5*(r-h)+"px";break;case"bottom":l.top=r-h+"px"}this.overlayText.css(l),!this.options.overlay_animation_onscreen&&(this.isDesktop&&"always"===this.options.desktop_show_trigger||!this.isDesktop&&"always"===this.options.touch_show_trigger)?(this.overlay.css("opacity",1),this.overlayText.css("opacity",1)):(this.options.overlay_animation&&"none"!==this.options.overlay_animation&&(this.animationTimeline=anime.timeline({autoplay:!1}),this.animationTimeline.add(this.getAnimationOptions(this.overlay.get(0),this.options.overlay_animation,{position:this.options.overlay_position}))),this.isDesktop?this.overlayText.css("opacity",1):this.options.text_animation&&"none"!==this.options.text_animation&&(this.animationTimeline||(this.animationTimeline=anime.timeline({autoplay:!1})),this.animationTimeline.add(this.getAnimationOptions(this.overlayText.get(0),this.options.text_animation))),"function"==typeof OnScreen&&this.options.overlay_animation_onscreen&&(this.isDesktop&&"always"===this.options.desktop_show_trigger||!this.isDesktop&&"always"===this.options.touch_show_trigger)&&setTimeout(function(){this.onScreen.on("enter",".so-premium-"+t.widget_id,function(){this.toggleOverlay(),this.onScreen.off("enter",".so-premium-"+t.widget_id)}.bind(this))}.bind(this),150)),this.isDesktop?"hover"===this.options.desktop_show_trigger&&(this.imageContainer.on("mouseenter",function(){this.isDesktop&&this.showOverlay()}.bind(this)),this.imageContainer.on("mouseleave",function(){this.hideOverlay()}.bind(this))):"touch"===this.options.touch_show_trigger&&this.imageContainer.on("touchend",function(){this.toggleOverlay()}.bind(this))},this.getAnimationOptions=function(i,t,e){var a={targets:i,changeBegin:function(){this.overlayContainer.css("overflow","hidden")}.bind(this)},n=o(i);switch(t){case"fade":a.easing="linear",a.duration=250,a.opacity=[0,1];break;case"slide":switch(a.easing="easeOutExpo",a.duration=500,n.css("opacity",1),e.hasOwnProperty("position")?e.position:"top"){case"top":a.translateY=[-n.outerHeight(),0];break;case"right":a.translateX=[n.parent().outerWidth(),0];break;case"bottom":a.translateY=[n.parent().outerHeight(),0];break;case"left":a.translateX=[-n.outerWidth(),0]}break;case"slide_left":a.easing="easeOutExpo",a.duration=500,a.opacity=[0,1],a.translateX=[20,0];break;case"slide_right":a.easing="easeOutExpo",a.duration=500,a.opacity=[0,1],a.translateX=[-20,0];break;case"slide_up":a.easing="easeOutExpo",a.duration=500,a.opacity=[0,1],a.translateY=[10,0];break;case"slide_down":a.easing="easeOutExpo",a.duration=500,a.opacity=[0,1],a.translateY=[-10,0];break;case"drop":a.easing="linear",a.duration=250,a.opacity=[0,1],a.scale=[1.1,1],a.changeBegin=function(){this.overlayContainer.css("overflow","visible")}.bind(this)}return a},this.addEventListeners=function(){this.imageContainer.is(".sow-masonry-grid-item,.sow-image-grid-image")&&this.imageContainer.closest(".sow-masonry-grid,.sow-image-grid-wrapper").on("layoutComplete",this.layoutChildren.bind(this)),o(window).on("resize",this.layoutChildren.bind(this))},this.showOverlay=function(){this.showingOverlay||(this.showingOverlay=!0,this.animationTimeline?("reverse"===this.animationTimeline.direction&&this.animationTimeline.reverse(),this.animationTimeline.began&&!this.animationTimeline.completed||this.animationTimeline.play()):this.overlay.css("opacity",1))},this.hideOverlay=function(){this.showingOverlay&&(this.showingOverlay=!1,this.animationTimeline?("normal"===this.animationTimeline.direction&&this.animationTimeline.reverse(),this.animationTimeline.completed&&(this.animationTimeline.completed=!1,this.animationTimeline.play())):this.overlay.css("opacity",0))},this.toggleOverlay=function(){if(this.animationTimeline)this.animationTimeline.began&&"normal"===this.animationTimeline.direction?this.hideOverlay():this.showOverlay();else{var i=1===this.overlay.css("opacity")?0:1;this.overlay.css("opacity",i)}},i.complete?this.init():(i.addEventListener("load",function(){this.init()}.bind(this)),i.addEventListener("error",(function(){console.log("Could not setup Image Overlay. Image loading failed.")})))},SiteOriginPremium.createImageOverlays=function(i){i(".so-widget-sow-image, .so-widget-sow-image-grid, .so-widget-sow-simple-masonry").each((function(t,e){var o=i(e);if(o.data("overlay-enabled")){var a=o.data("overlay-settings");i(e).find("img").each((function(t,e){e.title&&(e.classList.contains("jetpack-lazy-image")?i(e).on("jetpack-lazy-loaded-image",(function(i){new SiteOriginPremium.ImageOverlay(i.target,a,t)})):new SiteOriginPremium.ImageOverlay(e,a,t))}))}}))},jQuery((function(i){SiteOriginPremium.createImageOverlays(i),window.sowb&&i(window.sowb).on("setup_widgets",(function(){SiteOriginPremium.createImageOverlays(i)}))}));